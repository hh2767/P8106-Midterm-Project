---
title: "model_building_I"
author: "Yun He"
date: "April 2, 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE
                      )
library(caret)
theme1 <- trellis.par.get()
theme1$plot.symbol$col <- rgb(.2, .4, .2, .2) 
theme1$plot.symbol$pch <- 16
theme1$plot.line$col <- rgb(.8, .1, .1, 1) 
theme1$plot.line$lwd <- 2
theme1$strip.background$col <- rgb(.0, .2, .6, .2)
trellis.par.set(theme1)

library(tidyverse)
library(caret)
library(glmnet)
```

```{r, message=FALSE}
train = read_csv("./data/train.csv")
test = read_csv("./data/test.csv")

options(na.action = 'na.pass')
x <- model.matrix(transformed_value~., train)[,-1]
y <- train$transformed_value
```

## linear model

```{r}
set.seed(2)
ctrl1 <- trainControl(method = "cv", number = 10)
lm.fit <- train(x, y,
                method = "lm",
                preProcess = "medianImpute",
                trControl = ctrl1)
```

## ridge model

```{r}
set.seed(2)
ridge.fit <- train(x, y,
                   method = "glmnet",
                   tuneGrid = expand.grid(alpha = 0, 
                                          lambda = exp(seq(-10, 0, length=100))),
                   preProc = c("center", "scale", "medianImpute"),
                   trControl = ctrl1)
plot(ridge.fit, xTrans = function(x) log(x))
```

## lasso model

```{r}
set.seed(2)
lasso.fit <- train(x, y,
                   method = "glmnet",
                   tuneGrid = expand.grid(alpha = 1, 
                                          lambda = exp(seq(-10, -5, length=100))),
                   preProc = c("center", "scale", "medianImpute"),
                   trControl = ctrl1)
plot(lasso.fit, xTrans = function(x) log(x))
```

## Elastic net

```{r}
set.seed(2)
enet.fit <- train(x, y,
                     method = "glmnet",
                     tuneGrid = expand.grid(alpha = seq(0, 1, length = 5), 
                                            lambda = exp(seq(-10, -5, length=50))),
                     preProc = c("center", "scale", "medianImpute"),
                     trControl = ctrl1)
ggplot(enet.fit)
```

## pcr model

```{r}
set.seed(2)
pcr.fit <- train(x, y,
                  method = "pcr",
                  tuneLength = 38,
                  trControl = ctrl1,
                  preProc = c("medianImpute"),
                  scale = TRUE)
ggplot(pcr.fit, highlight = TRUE)
```

## pls model

```{r}
set.seed(2)
pls.fit <- train(x, y,
                 method = "pls",
                 tuneLength = 38,
                 trControl = ctrl1,
                 preProc = c("medianImpute"),
                 scale = TRUE)
ggplot(pls.fit, highlight = TRUE)
```


## summarize

```{r}
load(file = "./non-linear/gam_fit.rda")
load(file = "./non-linear/earth.rda")
resamp <- resamples(list(lasso = lasso.fit, 
                         ridge = ridge.fit,
                         enet = enet.fit,
                         pcr = pcr.fit, 
                         pls = pls.fit,
                         lm = lm.fit,
                         gam = gam.fit,
                         mars = mars.fit
                         ))
summary(resamp)

bwplot(resamp, metric = "RMSE")
```

